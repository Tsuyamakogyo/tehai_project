# プロジェクト名: 手配支援ツール

## 概要
手配支援ツールは、案件ごとの必要条件に応じてスタッフを自動割り当てする支援アプリケーションです。スタッフのスキル、ジャンル適正、過去実績（傾向スコア）、特性ワードによる優先度などを総合的に評価し、最適な配置を行います。

Web ベースでブラウザから簡単にアクセスできる **Streamlit アプリ** です。ブラウザ上で手配情報を入力・編集・再反映し、統計ログにも反映できます。

---

## 主な機能

- **スタッフ割り当てエンジン**  
  スキル評価（◎○△✕）・傾向スコア・note_preferenceによる特性優先ブーストなどを反映して最適なスタッフを自動提案

- **Streamlit アプリでの編集機能**  
  Webブラウザで手配情報を入力、結果表示をリアルタイムで確認できる。  
  将来的にはモバイル対応を検討しています。

- **傾向スコアロジック**  
  過去の配置履歴からジャンルごとの傾向スコアを算出・活用

- **note_preferenceマッチ**  
  備考欄に記載された「花岡金属：最優先」などのワードに基づいて配置優先度を自動ブースト

- **バリデーション機能**  
  重複配置や人数整合性エラーをチェックし、アラート表示

---

## 使用技術

- Python 3.7+
- 主なライブラリ：
  - `streamlit`: Webアプリ化（新規）
  - `pandas`: データ処理
  - `gspread`: Google Sheets連携
  - `subprocess`: 外部スクリプト実行
- Google Sheets API（顧客・人物データの取得に使用）

---

## 必要なファイル

- `config/tehai-reader-key.json`: Google Sheets API 認証キー  
- `config/rules.json`: スコアロジック・note_preferenceルールなどの定義

---

## 実行方法

### Streamlit版
```bash
streamlit run tools/tehai_streamlit_app.py

```
1. このコマンドで、Streamlitアプリが立ち上がります。
2. ブラウザに表示されるインターフェースを通じて、人物データのアップロード・処理を行います。

---

## ファイル構成（最新版）

```
tehai_project/
├── tehai_streamlit_app.py  # Streamlit版アプリ
├── app/
│   ├── input_handler.py        # 入力データパース
│   ├── data_formatter.py       # 出力整形
│   ├── assignment_core.py      # 割り当てロジック（スコア・傾向・特性反映）
│   ├── validation.py           # バリデーション
│   ├── adapter.py              # 入出力データ変換・整備
│   └── trend_analyzer.py       # 傾向スコア集計
├── tools/
│   └── data_preparer.py        # ←このファイルに.env呼び出しコードがある
├── config/
│   ├── .env                    # ← .env ファイル
│   ├── tehai-reader-key.json   # ← API キーを保存
│   └── rules.json              # スコアルール・特性設定
├── input/                      # 手配検討入力（CSV等）
├── output/                     # 出力結果・統計ログ
├── requirements.txt            # ライブラリ定義
├── venv/                       # 仮想環境ディレクトリ
├── .gitignore                  # ← .gitignore ファイル
└── README.md                   # プロジェクト概要
```

---

## スコアの意味（スキル記号）

スキル欄に使われる「◎○△✕」の記号は、以下のように数値化されます。

| 記号 | スコア | 意味           |
|------|--------|----------------|
| ◎   | 3      | 得意           |
| ○   | 2      | できる         |
| △   | 1      | 不慣れ・補佐可 |
| ✕   | 0      | 不可           |

このスコアが、ジャンル適正評価や傾向スコアと組み合わさり、スタッフの選定に利用されます。

---

## note_preference の記述ルール（特性ワード）

スタッフの備考欄に記載されたキーワードにより、特定案件への割り当てを優先ブーストできます。

### 書き方例：

```
備考：花岡金属：最優先|金属建具：優先|(仮称)三郷物流開発計画：最優先
```

### 対応項目：

- **ジャンル名**（例：`金属建具：優先`）
- **顧客名や現場名**（例：`花岡金属：最優先`）
- **案件名（表記ゆれ含め対応）**

### スコア換算（rules.jsonより）：

| 優先度ワード | 加点 |
|--------------|------|
| 最優先       | 100  |
| 優先         | 50   |

> normalize 処理により `(仮称)` や空白、記号の差異は無視してマッチします。

---

## ライセンス

MIT License

---

### 変更点まとめ
1. **`Streamlit` に完全対応**:  
   GUIアプリの説明を削除し、Streamlit 版を中心にした構成に変更。
2. **ファイル構成の修正**:  
   `tehai_streamlit_app.py` で動かすように記載。
3. **誤ったコマンドを修正**:  
   `streamlit run tools/tehai_app_streamlit.py` を、正しい `tools/tehai_streamlit_app.py` に修正。

---

### 次のステップ

- **README.md** はこれで完成です！
- 次のステップとしては **割り当てロジック（スコア・傾向・特性反映）** を精度を高める方向に進める段階ですね。  
  どの部分を改善したいか、さらに分析して進めていきましょう！
